extends layout

block content
  h1 to-do-list

  // Barre d’actions
  form(method="GET" action="/")
    .field
      label(for="q") Recherche (id, titre, description, date)
      input#q(type="text" name="q" placeholder="ex: 12 ou courses ou 2025-10-01" value=q)

    .row
      // Filtre état
      label(for="done") État
      select#done(name="done")
        option(value="") Tous
        option(value="0" selected=(done==='0')) À faire
        option(value="1" selected=(done==='1')) Fait

      // Filtre label
      label(for="labelId") Label
      select#labelId(name="labelId")
        option(value="") Tous
        each l in labels
          option(value=l.id selected=(String(labelId||'')===String(l.id)))= l.name

      // Tri
      label(for="orderBy") Trier par
      select#orderBy(name="orderBy")
        option(value="id" selected=(orderBy==='id')) id
        option(value="datetime" selected=(orderBy==='datetime')) date/heure
        option(value="titre" selected=(orderBy==='titre')) titre
        option(value="done" selected=(orderBy==='done')) état
        option(value="label" selected=(orderBy==='label')) label

      select(name="order")
        option(value="asc" selected=(order==='asc')) asc
        option(value="desc" selected=(order==='desc')) desc

      button(type="submit") Appliquer

    p
      a(href="/new") + Ajouter une tâche

  hr/

  // Bloc principal
  .section-columns
    .column
      h2 À faire
      if !tasksTodo.length
        p (aucune tâche)
      else
        each t in tasksTodo
          - var bg = (t.Label && t.Label.color) ? t.Label.color : '#ffffff'
          .card(style='background:' + bg + '; --card-bg:' + bg)
            h3= t.titre
            p Description: #{t.description || '—'}
            p Deadline: #{t.datetime ? new Date(t.datetime).toLocaleString() : '—'}
            p Label: #{t.Label ? (t.Label.name) : '—'}
            .actions
              a(href='/update/' + t.id) Update
              |  
              a(href='/delete/' + t.id) Delete

    .column
      h2 Fait
      if !tasksDone.length
        p (rien de terminé)
      else
        each t in tasksDone
          - var bg2 = (t.Label && t.Label.color) ? t.Label.color : '#ffffff'
          .card(style='background:' + bg2 + '; --card-bg:' + bg2)
            h3= t.titre
            p Description: #{t.description || '—'}
            p Deadline: #{t.datetime ? new Date(t.datetime).toLocaleString() : '—'}
            p Label: #{t.Label ? (t.Label.name) : '—'}
            .actions
              a(href='/update/' + t.id) Update
              |  
              a(href='/delete/' + t.id) Delete

  style.
    .row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      margin: 8px 0;
    }
    .section-columns {
      display: flex;
      gap: 24px;
      align-items: flex-start;
      justify-content: space-between;
    }
    .column {
      flex: 1;
      min-width: 0;
    }
    .card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      margin: 8px 0;
    }
    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    .actions a {
      text-decoration: none;
      padding: 6px 10px;
      border: 1px solid #fff;
      border-radius: 6px;
      color: #fff;
      transition: color .15s, background .15s;
    }
    .actions a:hover {
      background: #fff;
      color: var(--card-bg);
    }
